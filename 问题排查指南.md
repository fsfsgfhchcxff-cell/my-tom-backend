# 🔧 localhost 拒绝连接 - 问题排查指南

## ❌ 问题现象

浏览器访问时显示：
- "localhost 拒绝连接"
- "ERR_CONNECTION_REFUSED"
- "无法连接到服务器"

---

## ✅ 解决方案（按顺序尝试）

### 方案1：启动后端服务（最常见原因）⭐

**问题：** 后端 Spring Boot 没有运行

**解决步骤：**

#### 方法A：使用启动脚本（推荐）
```bash
1. 找到并双击：tom-learning-app\启动.bat
2. 等待看到 "Started TomLearningAppApplication" 提示
3. 窗口不要关闭，保持运行
```

#### 方法B：使用命令行
```bash
# 1. 打开新的命令行窗口（PowerShell 或 CMD）
# 2. 进入后端目录
cd D:\大三上\软件工程课设\tom-learning-app\tom-learning-app

# 3. 运行 Maven 命令
mvnw.cmd spring-boot:run

# 或者使用
.\mvnw.cmd spring-boot:run
```

#### 方法C：在 IDE 中运行
```
1. 打开 IDEA/Eclipse/VSCode
2. 找到 TomLearningAppApplication.java
3. 右键 → Run 'TomLearningAppApplication'
```

**✅ 启动成功标志：**
```
Started TomLearningAppApplication in X.XX seconds
Tomcat started on port 8081
```

**测试后端是否运行：**
```bash
# 打开浏览器访问
http://localhost:8081/api/game/ping

# 或使用 curl
curl http://localhost:8081/api/game/ping
```

应该返回：`{"status":"ok","message":"游戏服务运行正常！🎮"}`

---

### 方案2：检查端口占用

如果启动时提示"端口被占用"：

```bash
# 1. 查找占用端口的进程
netstat -ano | findstr :8081

# 2. 终止进程（替换 <PID> 为上面显示的进程ID）
taskkill /F /PID <PID>

# 3. 重新启动后端
```

---

### 方案3：确认正确的启动顺序

**✅ 正确顺序：**

```
第1步：启动后端（8081端口）
  ↓ 等待完全启动
第2步：启动前端（3000端口）
```

**注意：** 必须先启动后端，否则前端无法连接！

---

### 方案4：检查防火墙设置

有时候 Windows 防火墙会阻止连接：

```bash
# 方法1：临时关闭防火墙测试
控制面板 → Windows Defender 防火墙 → 启用或关闭 → 关闭（测试用）

# 方法2：添加例外规则
控制面板 → Windows Defender 防火墙 → 高级设置 → 入站规则 → 新建规则
→ 端口 → TCP → 特定本地端口：8081
```

---

### 方案5：修改代理设置

如果你用了代理软件（如 V2Ray、Clash）：

```bash
# 临时关闭代理测试
1. 关闭代理软件
2. 浏览器设置 → 代理 → 不使用代理
3. 重新访问 localhost:8081
```

---

### 方案6：清理并重新构建

如果后端启动失败：

```bash
# 1. 清理项目
cd tom-learning-app
mvnw.cmd clean

# 2. 重新编译
mvnw.cmd compile

# 3. 重新启动
mvnw.cmd spring-boot:run
```

---

### 方案7：检查 Java 环境

```bash
# 检查 Java 版本（需要 Java 21+）
java -version

# 应该看到类似：
# openjdk version "21.0.x" 或更高
```

如果没有 Java 或版本太低：
- 下载并安装 JDK 21：https://adoptium.net/

---

## 🎯 完整启动检查清单

### 前置条件检查

- [ ] Java 21 或更高版本已安装
- [ ] 8081 端口未被占用
- [ ] 项目路径中没有中文（建议）
- [ ] 防火墙允许 8081 端口

### 启动步骤检查

- [ ] **第1步：** 打开命令行窗口
- [ ] **第2步：** 进入后端目录 `cd tom-learning-app`
- [ ] **第3步：** 运行启动命令 `mvnw.cmd spring-boot:run`
- [ ] **第4步：** 等待看到 "Started" 提示（可能需要1-2分钟）
- [ ] **第5步：** 测试后端 `http://localhost:8081/api/game/ping`
- [ ] **第6步：** 后端正常后，启动前端 `cd ../frontend && npm start`

---

## 🔍 诊断命令

### 快速检查脚本

复制到命令行运行：

```bash
echo ========== 系统诊断 ==========
echo.
echo [1] 检查 Java 版本:
java -version
echo.
echo [2] 检查 8081 端口:
netstat -ano | findstr :8081
echo.
echo [3] 检查 3000 端口:
netstat -ano | findstr :3000
echo.
echo [4] 测试后端连接:
curl http://localhost:8081/api/game/ping
echo.
echo ========== 诊断完成 ==========
```

---

## 📞 常见错误信息对照

### 错误1：`Connection refused`
**原因：** 后端未启动
**解决：** 启动后端服务

### 错误2：`Port 8081 was already in use`
**原因：** 端口被占用
**解决：** 终止占用进程或换端口

### 错误3：`java: command not found`
**原因：** Java 未安装或未配置环境变量
**解决：** 安装 JDK 21

### 错误4：`Cannot find mvnw.cmd`
**原因：** 不在正确的目录
**解决：** 确保在 `tom-learning-app` 目录下

### 错误5：前端显示 `Network Error`
**原因：** 后端未启动或端口不对
**解决：** 先启动后端

---

## 🎮 启动成功的标志

### 后端启动成功
```
✅ 命令行显示：Started TomLearningAppApplication in X.XX seconds
✅ 访问 http://localhost:8081/api/game/ping 有响应
✅ 访问 http://localhost:8081/h2-console 能打开
```

### 前端启动成功
```
✅ 自动打开浏览器到 http://localhost:3000
✅ 看到可爱的登录界面 🐱
✅ 控制台没有红色错误
```

---

## 💡 推荐方案

### 🌟 最简单的方式（推荐给新手）

**使用 IDE 启动（IDEA/Eclipse）：**

1. 导入项目到 IDE
2. 找到 `TomLearningAppApplication.java`
3. 点击绿色运行按钮 ▶️
4. 等待启动完成
5. 打开新终端窗口启动前端

**优点：**
- 不用记命令
- 有图形界面
- 错误提示清晰
- 方便调试

---

## 🆘 还是不行？

### 最后的杀手锏

```bash
# 1. 完全清理
cd tom-learning-app
mvnw.cmd clean

# 2. 删除 target 目录
rmdir /s /q target

# 3. 重新下载依赖
mvnw.cmd dependency:resolve

# 4. 重新启动
mvnw.cmd spring-boot:run
```

---

## 📸 截图帮助

如果还是解决不了，请提供：
1. 启动后端时的完整错误信息
2. `java -version` 的输出
3. `netstat -ano | findstr :8081` 的输出
4. 浏览器 F12 控制台的错误信息

---

**祝你顺利启动！** 🎉

